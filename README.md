# SOYM_DiscordBot
身内用Discordサーバー専用Bot。~~結構無理矢理なソースコードだけど割としっかり動いてるから見逃してくれ~~

こちらのBotはWindows向けに開発しているため、他の環境だと動作しません。暇があればLinux、Macにも対応したいとは思ってますがいつになるか分かりません。

## 機能・用途

- Twitterのオンゲキ公式アカウント([@ongeki_official](https://twitter.com/ongeki_official))からのツイートをリアルタイムで取得し、新曲追加に関するツイートのURLをDiscordの特定チャンネルに送信します。

## 使い方
以下のものを準備し、同梱の`OAuthData.py`に書き込んでください。

- TwitterのBotとAPI、アクセストークン等
- DiscordのBotとトークン
- 送信対象のチャンネルのid

#### v1.0.5.211101以前の場合
初めにPythonをインストールしてください。これがないと何も始まりません。
次に`discord.py`と`twitter`、`pyyaml`の3つのライブラリをインストールしてください。これらのインストール方法はv1.1.0.211209以降(リリース予定)にてインストール機能を実装する関係上こちらには記載しません。

これらのライブラリ等インストールができたら、`main.py`をダブルクリックで実行してください。

#### v1.1.0.211209以降の場合
`BOT_START.bat`をダブルクリックで実行してください。
起動時、PythonまたはBotの動作に必要なライブラリをインストールするよう求められた場合は画面の指示に従ってインストールしてください。インストールしないとBotが動きません。

## ツイートの抽出条件
基本的には一つのツイートの本文に含まれているワードにて判定を行っています。

- `追加`というワードが含まれていた際、`新曲`もしくは`楽曲`というワードも同時に含まれていた場合
- `一挙公開`というワードが含まれていた場合
- `LUNATIC`というワードが含まれていた場合

## 既知のバグ等

- Botが取得できる文字数幅を超えたツイートがあった場合、文字数幅よりも後に一致する判定ワードがあってもツイートを抽出できない。
- 過去にオンゲキ公式アカウントからツイートされたことのある新曲追加ツイートにて、現状のコードだと抽出が不可能なツイートが存在する。
- 初回起動時、ログ出力先のディレクトリが見つからずエラーを吐く。(v1.0.5.211110にて修正済)
  - 起動前に`main.py`と同じ階層に`logdump`ディレクトリを作成してください。

## 今後実装予定の機能または変更点
こちらに記載されているもの以外でも、要望があったものの中で実現可能なものは実装します。

- コマンド操作機能。コマンドを入力することでBotの設定を操作したりすることができるようにする「予定」。あくまで「予定」。
- `OAuthData.py`に未記入の項目があった場合はエラーをログに出力する機能
- ini形式のBotの設定ファイルの追加

## 変更履歴
RC版などの細かなマイナーバージョンについては最新版のみ記載します。

- **v1.0.0.211008**
  - 初版
- **v1.0.1.211021**

  主にログ出力機能のアップデート。

  - Bot起動時、古いログファイルがあった場合はリネームし、新しいログファイルに記録するようにした
  - Bot起動時、ログファイルにバージョンを記録するようにした
- **v1.0.2.211021**
  - 抽出条件に当てはまるツイートの中で、オンゲキ公式アカウント自身のリツイートも拾ってしまう問題を修正
- **v1.0.3.211101**
  - 抽出条件に関わらず、リツイート自体を無視するようにした
- **v1.0.4.211103**
  - v1.0.2.211021へのロールバックを実施(変更内容はv1.0.3.211101と同じ)
- **v1.0.5.211101**
  - Bot起動時、ウインドウタイトルを設定するようにした
  - Bot起動時、ログ出力先ディレクトリが存在しない場合作成するようにした
- **v1.1.0.211214**

  専門の知識がない人でもBotを比較的容易に導入できるような機能を重点的に追加した。

  - Botを起動する際、`main.py`からではなく`BOT_START.bat`から起動する仕様に変更した
  - Bot起動時、Pythonがインストールされていない場合ストアに誘導する機能を追加
  - Bot起動時、Botの動作に必要なライブラリをインストールできる機能を追加
  - Bot起動時、Botの動作に必要なデータ、ファイルが揃っているかどうかをチェックする機能を追加
  - ログ設定ファイルのデータフォーマットをyamlからjsonに変更
